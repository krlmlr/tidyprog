<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>4 Pairwise iteration and nesting | Programming in the tidyverse</title>
  <meta name="description" content="4 Pairwise iteration and nesting | Programming in the tidyverse">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="4 Pairwise iteration and nesting | Programming in the tidyverse" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Pairwise iteration and nesting | Programming in the tidyverse" />
  
  
  

<meta name="author" content="Kirill Müller, Tobias Schieferdecker">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="simple-iteration.html">
<link rel="next" href="scoping-and-flow-control.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="scroll.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#links"><i class="fa fa-check"></i>Links</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#package-versions-used"><i class="fa fa-check"></i>Package versions used</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#overview"><i class="fa fa-check"></i><b>1.1</b> Overview</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#review-of-visualization-and-data-transformation"><i class="fa fa-check"></i><b>1.2</b> Review of visualization and data transformation</a><ul>
<li class="chapter" data-level="1.2.1" data-path="introduction.html"><a href="introduction.html#intro-data"><i class="fa fa-check"></i><b>1.2.1</b> Data</a></li>
<li class="chapter" data-level="1.2.2" data-path="introduction.html"><a href="introduction.html#exploration"><i class="fa fa-check"></i><b>1.2.2</b> Exploration</a></li>
<li class="chapter" data-level="1.2.3" data-path="introduction.html"><a href="introduction.html#further-dplyr-transformations"><i class="fa fa-check"></i><b>1.2.3</b> Further dplyr transformations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="function-basics.html"><a href="function-basics.html"><i class="fa fa-check"></i><b>2</b> Function basics</a><ul>
<li class="chapter" data-level="2.1" data-path="function-basics.html"><a href="function-basics.html#definition-and-execution"><i class="fa fa-check"></i><b>2.1</b> Definition and execution</a><ul>
<li class="chapter" data-level="2.1.1" data-path="function-basics.html"><a href="function-basics.html#exercises"><i class="fa fa-check"></i><b>2.1.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="function-basics.html"><a href="function-basics.html#args"><i class="fa fa-check"></i><b>2.2</b> Arguments</a><ul>
<li class="chapter" data-level="2.2.1" data-path="function-basics.html"><a href="function-basics.html#exercises-1"><i class="fa fa-check"></i><b>2.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="function-basics.html"><a href="function-basics.html#intermediate"><i class="fa fa-check"></i><b>2.3</b> Use case: Intermediate variables</a><ul>
<li class="chapter" data-level="2.3.1" data-path="function-basics.html"><a href="function-basics.html#exercises-2"><i class="fa fa-check"></i><b>2.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="function-basics.html"><a href="function-basics.html#default-values"><i class="fa fa-check"></i><b>2.4</b> Default values</a><ul>
<li class="chapter" data-level="2.4.1" data-path="function-basics.html"><a href="function-basics.html#exercises-3"><i class="fa fa-check"></i><b>2.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="function-basics.html"><a href="function-basics.html#multiple-arguments"><i class="fa fa-check"></i><b>2.5</b> Multiple arguments</a><ul>
<li class="chapter" data-level="2.5.1" data-path="function-basics.html"><a href="function-basics.html#exercises-4"><i class="fa fa-check"></i><b>2.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="function-basics.html"><a href="function-basics.html#argument-matching"><i class="fa fa-check"></i><b>2.6</b> Argument matching</a><ul>
<li class="chapter" data-level="2.6.1" data-path="function-basics.html"><a href="function-basics.html#exercises-5"><i class="fa fa-check"></i><b>2.6.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="simple-iteration.html"><a href="simple-iteration.html"><i class="fa fa-check"></i><b>3</b> Simple iteration</a><ul>
<li class="chapter" data-level="3.1" data-path="simple-iteration.html"><a href="simple-iteration.html#vectors-and-columns"><i class="fa fa-check"></i><b>3.1</b> Vectors and columns</a><ul>
<li class="chapter" data-level="3.1.1" data-path="simple-iteration.html"><a href="simple-iteration.html#exercises-6"><i class="fa fa-check"></i><b>3.1.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="simple-iteration.html"><a href="simple-iteration.html#names"><i class="fa fa-check"></i><b>3.2</b> Named vectors and two-column tibbles</a><ul>
<li class="chapter" data-level="3.2.1" data-path="simple-iteration.html"><a href="simple-iteration.html#exercises-7"><i class="fa fa-check"></i><b>3.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="simple-iteration.html"><a href="simple-iteration.html#indexing"><i class="fa fa-check"></i><b>3.3</b> Indexing/subsetting</a><ul>
<li class="chapter" data-level="3.3.1" data-path="simple-iteration.html"><a href="simple-iteration.html#exercises-8"><i class="fa fa-check"></i><b>3.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="simple-iteration.html"><a href="simple-iteration.html#construction"><i class="fa fa-check"></i><b>3.4</b> Construction</a><ul>
<li class="chapter" data-level="3.4.1" data-path="simple-iteration.html"><a href="simple-iteration.html#exercises-9"><i class="fa fa-check"></i><b>3.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="simple-iteration.html"><a href="simple-iteration.html#map"><i class="fa fa-check"></i><b>3.5</b> Processing multiple files</a><ul>
<li class="chapter" data-level="3.5.1" data-path="simple-iteration.html"><a href="simple-iteration.html#exercises-10"><i class="fa fa-check"></i><b>3.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="simple-iteration.html"><a href="simple-iteration.html#map_manip"><i class="fa fa-check"></i><b>3.6</b> Manipulating all datasets</a><ul>
<li class="chapter" data-level="3.6.1" data-path="simple-iteration.html"><a href="simple-iteration.html#exercises-11"><i class="fa fa-check"></i><b>3.6.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="simple-iteration.html"><a href="simple-iteration.html#typed-output"><i class="fa fa-check"></i><b>3.7</b> Typed output</a><ul>
<li class="chapter" data-level="3.7.1" data-path="simple-iteration.html"><a href="simple-iteration.html#exercises-12"><i class="fa fa-check"></i><b>3.7.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="pairwise-iteration-and-nesting.html"><a href="pairwise-iteration-and-nesting.html"><i class="fa fa-check"></i><b>4</b> Pairwise iteration and nesting</a><ul>
<li class="chapter" data-level="4.1" data-path="pairwise-iteration-and-nesting.html"><a href="pairwise-iteration-and-nesting.html#manipulating-pairwise"><i class="fa fa-check"></i><b>4.1</b> Manipulating pairwise</a><ul>
<li class="chapter" data-level="4.1.1" data-path="pairwise-iteration-and-nesting.html"><a href="pairwise-iteration-and-nesting.html#exercises-13"><i class="fa fa-check"></i><b>4.1.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="pairwise-iteration-and-nesting.html"><a href="pairwise-iteration-and-nesting.html#mut_map"><i class="fa fa-check"></i><b>4.2</b> Moving to tibble-land</a><ul>
<li class="chapter" data-level="4.2.1" data-path="pairwise-iteration-and-nesting.html"><a href="pairwise-iteration-and-nesting.html#exercises-14"><i class="fa fa-check"></i><b>4.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="pairwise-iteration-and-nesting.html"><a href="pairwise-iteration-and-nesting.html#nest"><i class="fa fa-check"></i><b>4.3</b> Nesting and unnesting</a><ul>
<li class="chapter" data-level="4.3.1" data-path="pairwise-iteration-and-nesting.html"><a href="pairwise-iteration-and-nesting.html#exercises-15"><i class="fa fa-check"></i><b>4.3.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="scoping-and-flow-control.html"><a href="scoping-and-flow-control.html"><i class="fa fa-check"></i><b>5</b> Scoping and flow control</a><ul>
<li class="chapter" data-level="5.1" data-path="scoping-and-flow-control.html"><a href="scoping-and-flow-control.html#scope"><i class="fa fa-check"></i><b>5.1</b> Scope</a><ul>
<li class="chapter" data-level="5.1.1" data-path="scoping-and-flow-control.html"><a href="scoping-and-flow-control.html#exercises-16"><i class="fa fa-check"></i><b>5.1.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="scoping-and-flow-control.html"><a href="scoping-and-flow-control.html#pure-functions-and-side-effects"><i class="fa fa-check"></i><b>5.2</b> Pure functions and side effects</a><ul>
<li class="chapter" data-level="5.2.1" data-path="scoping-and-flow-control.html"><a href="scoping-and-flow-control.html#exercises-17"><i class="fa fa-check"></i><b>5.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="scoping-and-flow-control.html"><a href="scoping-and-flow-control.html#control-flow"><i class="fa fa-check"></i><b>5.3</b> Control flow</a><ul>
<li class="chapter" data-level="5.3.1" data-path="scoping-and-flow-control.html"><a href="scoping-and-flow-control.html#exercises-18"><i class="fa fa-check"></i><b>5.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="scoping-and-flow-control.html"><a href="scoping-and-flow-control.html#closures"><i class="fa fa-check"></i><b>5.4</b> Closures</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="non-rectangular-data.html"><a href="non-rectangular-data.html"><i class="fa fa-check"></i><b>6</b> Non-rectangular data</a><ul>
<li class="chapter" data-level="6.1" data-path="non-rectangular-data.html"><a href="non-rectangular-data.html#berlin"><i class="fa fa-check"></i><b>6.1</b> Traversing</a></li>
<li class="chapter" data-level="6.2" data-path="non-rectangular-data.html"><a href="non-rectangular-data.html#komoot"><i class="fa fa-check"></i><b>6.2</b> Iterating and traversing</a></li>
<li class="chapter" data-level="6.3" data-path="non-rectangular-data.html"><a href="non-rectangular-data.html#multipluck"><i class="fa fa-check"></i><b>6.3</b> Plucking multiple locations</a></li>
<li class="chapter" data-level="6.4" data-path="non-rectangular-data.html"><a href="non-rectangular-data.html#flatten"><i class="fa fa-check"></i><b>6.4</b> Flattening</a></li>
<li class="chapter" data-level="6.5" data-path="non-rectangular-data.html"><a href="non-rectangular-data.html#transpose"><i class="fa fa-check"></i><b>6.5</b> Transposing</a></li>
<li class="chapter" data-level="6.6" data-path="non-rectangular-data.html"><a href="non-rectangular-data.html#rectangulate"><i class="fa fa-check"></i><b>6.6</b> Rectangling</a></li>
<li class="chapter" data-level="6.7" data-path="non-rectangular-data.html"><a href="non-rectangular-data.html#accessing-apis"><i class="fa fa-check"></i><b>6.7</b> Accessing APIs</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html"><i class="fa fa-check"></i><b>7</b> Tidy evaluation</a></li>
<li class="chapter" data-level="8" data-path="best-practices.html"><a href="best-practices.html"><i class="fa fa-check"></i><b>8</b> Best practices</a><ul>
<li class="chapter" data-level="8.1" data-path="best-practices.html"><a href="best-practices.html#description"><i class="fa fa-check"></i><b>8.1</b> DESCRIPTION</a></li>
<li class="chapter" data-level="8.2" data-path="best-practices.html"><a href="best-practices.html#r"><i class="fa fa-check"></i><b>8.2</b> R</a></li>
<li class="chapter" data-level="8.3" data-path="best-practices.html"><a href="best-practices.html#roxygen2"><i class="fa fa-check"></i><b>8.3</b> roxygen2</a></li>
<li class="chapter" data-level="8.4" data-path="best-practices.html"><a href="best-practices.html#testthat"><i class="fa fa-check"></i><b>8.4</b> testthat</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i># References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Programming in the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="pairwise-iteration-and-nesting" class="section level1">
<h1><span class="header-section-number">4</span> Pairwise iteration and nesting</h1>
<p>This chapter explores iterating over pairs (or generally lists) of vectors of the same length.
The relationship between vectors and data frame columns is especially helpful here, because values in one row of a tibble naturally correspond to accessing the same index in multiple vectors.</p>
<p>This chapter uses the <code>manipulated_data</code> object from the <a href="simple-iteration.html#map_manip">“Manipulating all datasets”</a> section.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(here)

dict &lt;-<span class="st"> </span>readxl<span class="op">::</span><span class="kw">read_excel</span>(<span class="kw">here</span>(<span class="st">&quot;data/cities.xlsx&quot;</span>))

input_data &lt;-
<span class="st">  </span>dict <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(city_code, weather_filename) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">deframe</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span>readxl<span class="op">::</span><span class="kw">read_excel</span>(<span class="kw">here</span>(.)))

manipulator &lt;-<span class="st"> </span><span class="cf">function</span>(data) {
  data <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(time, <span class="kw">contains</span>(<span class="st">&quot;emperature&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(temperature <span class="op">&gt;=</span><span class="st"> </span><span class="dv">14</span>)
}

manipulated_data &lt;-
<span class="st">  </span>input_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">map</span>(manipulator)

manipulated_data</code></pre>
<PRE class="fansi fansi-output"><CODE>## $berlin
## <span style='color: #555555;'># A tibble: 16 x 3</span><span>
##   </span><span style='font-weight: bold;'>time</span><span>                </span><span style='font-weight: bold;'>temperature</span><span> </span><span style='font-weight: bold;'>apparentTemperature</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;dttm&gt;</span><span>                    </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>               </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> 2019-04-28 </span><span style='color: #555555;'>17:00:00</span><span>        14.1                14.1
## </span><span style='color: #555555;'>2</span><span> 2019-04-29 </span><span style='color: #555555;'>12:00:00</span><span>        15.6                15.6
## </span><span style='color: #555555;'>3</span><span> 2019-04-29 </span><span style='color: #555555;'>13:00:00</span><span>        17.4                17.4
## </span><span style='color: #555555;'># … with 13 more rows</span><span>
## 
## $toronto
## </span><span style='color: #555555;'># A tibble: 0 x 3</span><span>
## </span><span style='color: #555555;'># … with 3 variables: </span><span style='color: #555555;font-weight: bold;'>time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dttm&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>temperature</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>apparentTemperature</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
## 
## $tel_aviv
## </span><span style='color: #555555;'># A tibble: 49 x 3</span><span>
##   </span><span style='font-weight: bold;'>time</span><span>                </span><span style='font-weight: bold;'>temperature</span><span> </span><span style='font-weight: bold;'>apparentTemperature</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;dttm&gt;</span><span>                    </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>               </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> 2019-04-28 </span><span style='color: #555555;'>15:00:00</span><span>        23.9                23.9
## </span><span style='color: #555555;'>2</span><span> 2019-04-28 </span><span style='color: #555555;'>16:00:00</span><span>        23.1                23.1
## </span><span style='color: #555555;'>3</span><span> 2019-04-28 </span><span style='color: #555555;'>17:00:00</span><span>        22.4                22.4
## </span><span style='color: #555555;'># … with 46 more rows</span><span>
## 
## $zurich
## </span><span style='color: #555555;'># A tibble: 1 x 3</span><span>
##   </span><span style='font-weight: bold;'>time</span><span>                </span><span style='font-weight: bold;'>temperature</span><span> </span><span style='font-weight: bold;'>apparentTemperature</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;dttm&gt;</span><span>                    </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>               </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> 2019-04-30 </span><span style='color: #555555;'>15:00:00</span><span>        14.3                14.3
</span></CODE></PRE>
<div id="manipulating-pairwise" class="section level2">
<h2><span class="header-section-number">4.1</span> Manipulating pairwise</h2>
<p>Here we take discuss cases when you want to iterate through two lists (of the same length) in parallel and use each value pair as two of the input parameters of a function.</p>
<p>We first prepare a list of future output filenames:</p>
<pre class="sourceCode r"><code class="sourceCode r">output_filenames &lt;-<span class="st"> </span><span class="kw">tempfile</span>(<span class="kw">names</span>(manipulated_data), <span class="dt">fileext =</span> <span class="st">&quot;.csv&quot;</span>)
output_filenames</code></pre>
<pre><code>## [1] &quot;/tmp/RtmpGKZDK2/berlin2c68492865e4.csv&quot;  
## [2] &quot;/tmp/RtmpGKZDK2/toronto2c687726e28f.csv&quot; 
## [3] &quot;/tmp/RtmpGKZDK2/tel_aviv2c685176118e.csv&quot;
## [4] &quot;/tmp/RtmpGKZDK2/zurich2c68350aad59.csv&quot;</code></pre>
<p>We want to use <code>readr::write_csv()</code> to write each tibble into the respective file.
<code>write_csv()</code> needs at least 2 arguments: the tibble itself and the path to the filename.
We use <code>map2()</code> to handle this:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map2</span>(manipulated_data, output_filenames, <span class="op">~</span><span class="st"> </span>readr<span class="op">::</span><span class="kw">write_csv</span>(..<span class="dv">1</span>, ..<span class="dv">2</span>))</code></pre>
<PRE class="fansi fansi-output"><CODE>## $berlin
## <span style='color: #555555;'># A tibble: 16 x 3</span><span>
##   </span><span style='font-weight: bold;'>time</span><span>                 </span><span style='font-weight: bold;'>temperature</span><span> </span><span style='font-weight: bold;'>apparentTemperature</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>                      </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>               </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> 2019-04-28T17:00:00Z        14.1                14.1
## </span><span style='color: #555555;'>2</span><span> 2019-04-29T12:00:00Z        15.6                15.6
## </span><span style='color: #555555;'>3</span><span> 2019-04-29T13:00:00Z        17.4                17.4
## </span><span style='color: #555555;'># … with 13 more rows</span><span>
## 
## $toronto
## </span><span style='color: #555555;'># A tibble: 0 x 3</span><span>
## </span><span style='color: #555555;'># … with 3 variables: </span><span style='color: #555555;font-weight: bold;'>time</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>temperature</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>apparentTemperature</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
## 
## $tel_aviv
## </span><span style='color: #555555;'># A tibble: 49 x 3</span><span>
##   </span><span style='font-weight: bold;'>time</span><span>                 </span><span style='font-weight: bold;'>temperature</span><span> </span><span style='font-weight: bold;'>apparentTemperature</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>                      </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>               </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> 2019-04-28T15:00:00Z        23.9                23.9
## </span><span style='color: #555555;'>2</span><span> 2019-04-28T16:00:00Z        23.1                23.1
## </span><span style='color: #555555;'>3</span><span> 2019-04-28T17:00:00Z        22.4                22.4
## </span><span style='color: #555555;'># … with 46 more rows</span><span>
## 
## $zurich
## </span><span style='color: #555555;'># A tibble: 1 x 3</span><span>
##   </span><span style='font-weight: bold;'>time</span><span>                 </span><span style='font-weight: bold;'>temperature</span><span> </span><span style='font-weight: bold;'>apparentTemperature</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>                      </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>               </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> 2019-04-30T15:00:00Z        14.3                14.3
</span></CODE></PRE>
<p>Since we are just interested in the side-effects of <code>write_csv()</code> and not in the displayed output, we rather use the related function <code>walk2()</code>, which does not return output.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">walk2</span>(manipulated_data, output_filenames, <span class="op">~</span><span class="st"> </span>readr<span class="op">::</span><span class="kw">write_csv</span>(..<span class="dv">1</span>, ..<span class="dv">2</span>))</code></pre>
<div id="exercises-13" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>What does the following code display?</p>
<pre class="sourceCode r"><code class="sourceCode r">manipulated_data <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">walk2</span>(output_filenames, <span class="op">~</span><span class="st"> </span>readr<span class="op">::</span><span class="kw">write_csv</span>(..<span class="dv">1</span>, ..<span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">map_int</span>(nrow)</code></pre></li>
</ol>
</div>
</div>
<div id="mut_map" class="section level2">
<h2><span class="header-section-number">4.2</span> Moving to tibble-land</h2>
<details>
<p><summary><em>Click here to show setup code.</em></summary></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(here)

dict &lt;-<span class="st"> </span>readxl<span class="op">::</span><span class="kw">read_excel</span>(<span class="kw">here</span>(<span class="st">&quot;data/cities.xlsx&quot;</span>))

input_data &lt;-
<span class="st">  </span>dict <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(city_code, weather_filename) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">deframe</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span>readxl<span class="op">::</span><span class="kw">read_excel</span>(<span class="kw">here</span>(.)))</code></pre>
</details>
<p>How to combine the abilities of <code>map()</code> &amp; co., which work on vectors and lists, with our commonly used data structure, the tibble?</p>
<p>We start with the named list of tibbles called <code>input_data</code> from section <a href="simple-iteration.html#map">“Processing all files”</a> and with <code>dict</code> from section <a href="simple-iteration.html#names">“Named vectors and two-column tibbles”</a>.</p>
<p>Calling <code>enframe()</code> to produce a data frame from <code>input_data</code> leads to a maybe at first surprising, but oftentimes useful result:</p>
<pre class="sourceCode r"><code class="sourceCode r">input_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">enframe</span>()</code></pre>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 4 x 2</span><span>
##   </span><span style='font-weight: bold;'>name</span><span>     </span><span style='font-weight: bold;'>value</span><span>             
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;list&gt;</span><span>            
## </span><span style='color: #555555;'>1</span><span> berlin   </span><span style='color: #555555;'>&lt;tibble [49 × 18]&gt;</span><span>
## </span><span style='color: #555555;'>2</span><span> toronto  </span><span style='color: #555555;'>&lt;tibble [49 × 18]&gt;</span><span>
## </span><span style='color: #555555;'>3</span><span> tel_aviv </span><span style='color: #555555;'>&lt;tibble [49 × 17]&gt;</span><span>
## </span><span style='color: #555555;'>4</span><span> zurich   </span><span style='color: #555555;'>&lt;tibble [49 × 18]&gt;</span><span>
</span></CODE></PRE>
<p>This is because lists are also vectors.
In our case each list entry contains a tibble, which can be “nested” into each entry of column <code>value</code>.</p>
<p>Starting with the tibble <code>dict</code> we can see how <code>dpylr::mutate()</code> and <code>map()</code> can nicely work together to produce a somewhat similar result:</p>
<pre class="sourceCode r"><code class="sourceCode r">dict <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(city_code, weather_filename) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">data =</span> <span class="kw">map</span>(weather_filename, <span class="op">~</span><span class="st"> </span>readxl<span class="op">::</span><span class="kw">read_excel</span>(<span class="kw">here</span>(.)))
  )</code></pre>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 4 x 3</span><span>
##   </span><span style='font-weight: bold;'>city_code</span><span> </span><span style='font-weight: bold;'>weather_filename</span><span>           </span><span style='font-weight: bold;'>data</span><span>              
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>                      </span><span style='color: #555555;font-style: italic;'>&lt;list&gt;</span><span>            
## </span><span style='color: #555555;'>1</span><span> berlin    data/weather/berlin.xlsx   </span><span style='color: #555555;'>&lt;tibble [49 × 18]&gt;</span><span>
## </span><span style='color: #555555;'>2</span><span> toronto   data/weather/toronto.xlsx  </span><span style='color: #555555;'>&lt;tibble [49 × 18]&gt;</span><span>
## </span><span style='color: #555555;'>3</span><span> tel_aviv  data/weather/tel_aviv.xlsx </span><span style='color: #555555;'>&lt;tibble [49 × 17]&gt;</span><span>
## </span><span style='color: #555555;'>4</span><span> zurich    data/weather/zurich.xlsx   </span><span style='color: #555555;'>&lt;tibble [49 × 18]&gt;</span><span>
</span></CODE></PRE>
<p>This works because <code>R</code> interprets columns of tibbles as vectors, which can be fed to <code>map()</code>.
Staying in “tibble-land” as long as possible helps retaining other iportant components of the data you are processing, so that you can keep using familiar data transformation tools.</p>
<pre class="sourceCode r"><code class="sourceCode r">dict_data &lt;-
<span class="st">  </span>dict <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">data =</span> <span class="kw">map</span>(weather_filename, <span class="op">~</span><span class="st"> </span>readxl<span class="op">::</span><span class="kw">read_excel</span>(<span class="kw">here</span>(.))),
    <span class="dt">rows =</span> <span class="kw">map_int</span>(data, nrow),
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>weather_filename)
dict_data</code></pre>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 4 x 6</span><span>
##   </span><span style='font-weight: bold;'>city_code</span><span> </span><span style='font-weight: bold;'>name</span><span>        </span><span style='font-weight: bold;'>lng</span><span>   </span><span style='font-weight: bold;'>lat</span><span> </span><span style='font-weight: bold;'>data</span><span>                </span><span style='font-weight: bold;'>rows</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;list&gt;</span><span>             </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> berlin    Berlin    13.4   52.5 </span><span style='color: #555555;'>&lt;tibble [49 × 18]&gt;</span><span>    49
## </span><span style='color: #555555;'>2</span><span> toronto   Toronto  -</span><span style='color: #BB0000;'>79.4</span><span>   43.7 </span><span style='color: #555555;'>&lt;tibble [49 × 18]&gt;</span><span>    49
## </span><span style='color: #555555;'>3</span><span> tel_aviv  Tel Aviv  34.8   32.1 </span><span style='color: #555555;'>&lt;tibble [49 × 17]&gt;</span><span>    49
## </span><span style='color: #555555;'>4</span><span> zurich    Zürich     8.54  47.4 </span><span style='color: #555555;'>&lt;tibble [49 × 18]&gt;</span><span>    49
</span></CODE></PRE>
<p>This pattern can also be used with the <code>map2()</code> family of functions:</p>
<pre class="sourceCode r"><code class="sourceCode r">dict_data <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">desc =</span> <span class="kw">map2_chr</span>(
      name, rows,
      <span class="op">~</span><span class="st"> </span><span class="kw">paste0</span>(<span class="kw">ncol</span>(..<span class="dv">2</span>), <span class="st">&quot; columns in data for &quot;</span>, ..<span class="dv">1</span>)
    )
  )</code></pre>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 4 x 7</span><span>
##   </span><span style='font-weight: bold;'>city_code</span><span> </span><span style='font-weight: bold;'>name</span><span>       </span><span style='font-weight: bold;'>lng</span><span>   </span><span style='font-weight: bold;'>lat</span><span> </span><span style='font-weight: bold;'>data</span><span>            </span><span style='font-weight: bold;'>rows</span><span> </span><span style='font-weight: bold;'>desc</span><span>                 
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;list&gt;</span><span>         </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>                
## </span><span style='color: #555555;'>1</span><span> berlin    Berlin   13.4   52.5 </span><span style='color: #555555;'>&lt;tibble [49 ×</span><span>…    49 </span><span style='color: #555555;'>"</span><span> columns in data fo…
## </span><span style='color: #555555;'>2</span><span> toronto   Toronto -</span><span style='color: #BB0000;'>79.4</span><span>   43.7 </span><span style='color: #555555;'>&lt;tibble [49 ×</span><span>…    49 </span><span style='color: #555555;'>"</span><span> columns in data fo…
## </span><span style='color: #555555;'>3</span><span> tel_aviv  Tel Av…  34.8   32.1 </span><span style='color: #555555;'>&lt;tibble [49 ×</span><span>…    49 </span><span style='color: #555555;'>"</span><span> columns in data fo…
## </span><span style='color: #555555;'>4</span><span> zurich    Zürich    8.54  47.4 </span><span style='color: #555555;'>&lt;tibble [49 ×</span><span>…    49 </span><span style='color: #555555;'>"</span><span> columns in data fo…
</span></CODE></PRE>
<p>More generally, <code>pmap()</code> supports functions with an arbitrary number of arguments:</p>
<pre class="sourceCode r"><code class="sourceCode r">dict_data <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">desc =</span> <span class="kw">pmap_chr</span>(
      <span class="kw">list</span>(name, rows),
      <span class="op">~</span><span class="st"> </span><span class="kw">paste0</span>(<span class="kw">ncol</span>(..<span class="dv">2</span>), <span class="st">&quot; columns in data for &quot;</span>, ..<span class="dv">1</span>)
    )
  )</code></pre>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 4 x 7</span><span>
##   </span><span style='font-weight: bold;'>city_code</span><span> </span><span style='font-weight: bold;'>name</span><span>       </span><span style='font-weight: bold;'>lng</span><span>   </span><span style='font-weight: bold;'>lat</span><span> </span><span style='font-weight: bold;'>data</span><span>            </span><span style='font-weight: bold;'>rows</span><span> </span><span style='font-weight: bold;'>desc</span><span>                 
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;list&gt;</span><span>         </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>                
## </span><span style='color: #555555;'>1</span><span> berlin    Berlin   13.4   52.5 </span><span style='color: #555555;'>&lt;tibble [49 ×</span><span>…    49 </span><span style='color: #555555;'>"</span><span> columns in data fo…
## </span><span style='color: #555555;'>2</span><span> toronto   Toronto -</span><span style='color: #BB0000;'>79.4</span><span>   43.7 </span><span style='color: #555555;'>&lt;tibble [49 ×</span><span>…    49 </span><span style='color: #555555;'>"</span><span> columns in data fo…
## </span><span style='color: #555555;'>3</span><span> tel_aviv  Tel Av…  34.8   32.1 </span><span style='color: #555555;'>&lt;tibble [49 ×</span><span>…    49 </span><span style='color: #555555;'>"</span><span> columns in data fo…
## </span><span style='color: #555555;'>4</span><span> zurich    Zürich    8.54  47.4 </span><span style='color: #555555;'>&lt;tibble [49 ×</span><span>…    49 </span><span style='color: #555555;'>"</span><span> columns in data fo…
</span></CODE></PRE>
<div id="exercises-14" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>The <code>imap()</code> family of functions iterates over a vector and its names:</p>
<pre class="sourceCode r"><code class="sourceCode r">input_data <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">imap_chr</span>(<span class="op">~</span><span class="st"> </span><span class="kw">paste0</span>(.y, <span class="st">&quot;: &quot;</span>, <span class="kw">nrow</span>(.x), <span class="st">&quot; rows&quot;</span>))</code></pre>
<pre><code>##              berlin             toronto            tel_aviv 
##   &quot;berlin: 49 rows&quot;  &quot;toronto: 49 rows&quot; &quot;tel_aviv: 49 rows&quot; 
##              zurich 
##   &quot;zurich: 49 rows&quot;</code></pre>
<p>Implement the same functionality using <code>map2()</code> inside a <code>mutate()</code>, and <code>enframe()</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r">manipulated_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">___</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">___ =</span> <span class="kw">map2</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">deframe</span>()</code></pre></li>
</ol>
</div>
</div>
<div id="nest" class="section level2">
<h2><span class="header-section-number">4.3</span> Nesting and unnesting</h2>
<details>
<p><summary><em>Click here to show setup code.</em></summary></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(here)

dict &lt;-<span class="st"> </span>readxl<span class="op">::</span><span class="kw">read_excel</span>(<span class="kw">here</span>(<span class="st">&quot;data/cities.xlsx&quot;</span>))

dict_data &lt;-
<span class="st">  </span>dict <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">data =</span> <span class="kw">map</span>(weather_filename, <span class="op">~</span><span class="st"> </span>readxl<span class="op">::</span><span class="kw">read_excel</span>(<span class="kw">here</span>(.)))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>weather_filename)</code></pre>
</details>
<p>How to work with nested data?</p>
<p>We start with the tibble <code>dict_data</code> from section <a href="pairwise-iteration-and-nesting.html#mut_map">“Moving to tibble-land”</a>, which includes the nested tibbles in its column <code>data</code>.</p>
<p>If we want to actually look at the data we can directly use <code>tidyr::unnest()</code> on the whole tibble, which by default acts on all list-columns.
This expands our tibble by repeating the formerly unnested column entries as many times, as each nested tibble has rows:</p>
<pre class="sourceCode r"><code class="sourceCode r">dict_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest</span>()</code></pre>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 196 x 22</span><span>
##   </span><span style='font-weight: bold;'>city_code</span><span> </span><span style='font-weight: bold;'>name</span><span>    </span><span style='font-weight: bold;'>lng</span><span>   </span><span style='font-weight: bold;'>lat</span><span> </span><span style='font-weight: bold;'>time</span><span>                </span><span style='font-weight: bold;'>summary</span><span> </span><span style='font-weight: bold;'>icon</span><span> 
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;dttm&gt;</span><span>              </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> berlin    Berl…  13.4  52.5 2019-04-28 </span><span style='color: #555555;'>15:00:00</span><span> Mostly… part…
## </span><span style='color: #555555;'>2</span><span> berlin    Berl…  13.4  52.5 2019-04-28 </span><span style='color: #555555;'>16:00:00</span><span> Mostly… part…
## </span><span style='color: #555555;'>3</span><span> berlin    Berl…  13.4  52.5 2019-04-28 </span><span style='color: #555555;'>17:00:00</span><span> Mostly… part…
## </span><span style='color: #555555;'># … with 193 more rows, and 15 more variables: </span><span style='color: #555555;font-weight: bold;'>precipIntensity</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>precipProbability</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>temperature</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>apparentTemperature</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>dewPoint</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>humidity</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>pressure</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>windSpeed</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>windGust</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>windBearing</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>cloudCover</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>uvIndex</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>,
## #   </span><span style='color: #555555;font-weight: bold;'>visibility</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>ozone</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #555555;'>, </span><span style='color: #555555;font-weight: bold;'>precipType</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>
</span></CODE></PRE>
<p>Data flattened in this way is useful if the parts can be combined naturally into a larger dataset.
Iterating over columns in the nested view corresponds to grouped operations in the flat view.</p>
<pre class="sourceCode r"><code class="sourceCode r">dict_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n =</span> <span class="kw">map_int</span>(data, nrow)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>data)</code></pre>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 4 x 5</span><span>
##   </span><span style='font-weight: bold;'>city_code</span><span> </span><span style='font-weight: bold;'>name</span><span>        </span><span style='font-weight: bold;'>lng</span><span>   </span><span style='font-weight: bold;'>lat</span><span>     </span><span style='font-weight: bold;'>n</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> berlin    Berlin    13.4   52.5    49
## </span><span style='color: #555555;'>2</span><span> toronto   Toronto  -</span><span style='color: #BB0000;'>79.4</span><span>   43.7    49
## </span><span style='color: #555555;'>3</span><span> tel_aviv  Tel Aviv  34.8   32.1    49
## </span><span style='color: #555555;'>4</span><span> zurich    Zürich     8.54  47.4    49
</span></CODE></PRE>
<pre class="sourceCode r"><code class="sourceCode r">dict_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(name)</code></pre>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 4 x 2</span><span>
##   </span><span style='font-weight: bold;'>name</span><span>         </span><span style='font-weight: bold;'>n</span><span>
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
## </span><span style='color: #555555;'>1</span><span> Berlin      49
## </span><span style='color: #555555;'>2</span><span> Tel Aviv    49
## </span><span style='color: #555555;'>3</span><span> Toronto     49
## </span><span style='color: #555555;'>4</span><span> Zürich      49
</span></CODE></PRE>
<p>Inversely, if you want to have a more condensed view of your data, you can nest again.
By default, the function <code>tidyr::nest()</code> will nest all data.
Therefore it is often useful to tell it, which columns to ignore:</p>
<pre class="sourceCode r"><code class="sourceCode r">dict_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">nest</span>(<span class="op">-</span>city_code, <span class="op">-</span>name, <span class="op">-</span>lng, <span class="op">-</span>lat)</code></pre>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 4 x 5</span><span>
##   </span><span style='font-weight: bold;'>city_code</span><span> </span><span style='font-weight: bold;'>name</span><span>        </span><span style='font-weight: bold;'>lng</span><span>   </span><span style='font-weight: bold;'>lat</span><span> </span><span style='font-weight: bold;'>data</span><span>              
##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;list&gt;</span><span>            
## </span><span style='color: #555555;'>1</span><span> berlin    Berlin    13.4   52.5 </span><span style='color: #555555;'>&lt;tibble [49 × 18]&gt;</span><span>
## </span><span style='color: #555555;'>2</span><span> toronto   Toronto  -</span><span style='color: #BB0000;'>79.4</span><span>   43.7 </span><span style='color: #555555;'>&lt;tibble [49 × 18]&gt;</span><span>
## </span><span style='color: #555555;'>3</span><span> tel_aviv  Tel Aviv  34.8   32.1 </span><span style='color: #555555;'>&lt;tibble [49 × 18]&gt;</span><span>
## </span><span style='color: #555555;'>4</span><span> zurich    Zürich     8.54  47.4 </span><span style='color: #555555;'>&lt;tibble [49 × 18]&gt;</span><span>
</span></CODE></PRE>
<p>Using this, we structure our data in new, customized ways.
For processing of daily data over all cities, we create a new column <code>date</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r">dict_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">as.Date</span>(time)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">nest</span>(<span class="op">-</span>date)</code></pre>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 3 x 2</span><span>
##   </span><span style='font-weight: bold;'>date</span><span>       </span><span style='font-weight: bold;'>data</span><span>              
##   </span><span style='color: #555555;font-style: italic;'>&lt;date&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;list&gt;</span><span>            
## </span><span style='color: #555555;'>1</span><span> 2019-04-28 </span><span style='color: #555555;'>&lt;tibble [36 × 22]&gt;</span><span>
## </span><span style='color: #555555;'>2</span><span> 2019-04-29 </span><span style='color: #555555;'>&lt;tibble [96 × 22]&gt;</span><span>
## </span><span style='color: #555555;'>3</span><span> 2019-04-30 </span><span style='color: #555555;'>&lt;tibble [64 × 22]&gt;</span><span>
</span></CODE></PRE>
<div id="exercises-15" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Implement the following code as a mapping over a nested tibble. Use a helper function:</p>
<pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize_all</span>(<span class="kw">list</span>(<span class="dt">Mean =</span> mean)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ungroup</span>()</code></pre>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 3 x 5</span><span>
 ##   </span><span style='font-weight: bold;'>Species</span><span> </span><span style='font-weight: bold;'>Sepal.Length_Me…</span><span> </span><span style='font-weight: bold;'>Sepal.Width_Mean</span><span> </span><span style='font-weight: bold;'>Petal.Length_Me…</span><span>
 ##   </span><span style='color: #555555;font-style: italic;'>&lt;fct&gt;</span><span>              </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>            </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>            </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
 ## </span><span style='color: #555555;'>1</span><span> setosa              5.01             3.43             1.46
 ## </span><span style='color: #555555;'>2</span><span> versic…             5.94             2.77             4.26
 ## </span><span style='color: #555555;'>3</span><span> virgin…             6.59             2.97             5.55
 ## </span><span style='color: #555555;'># … with 1 more variable: </span><span style='color: #555555;font-weight: bold;'>Petal.Width_Mean</span><span style='color: #555555;'> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
 </span></CODE></PRE>
<pre class="sourceCode r"><code class="sourceCode r">summarize_to_mean &lt;-<span class="st"> </span><span class="cf">function</span>(data) {
  data <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">___</span>(_____)
}

iris <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">nest</span>(___) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">data =</span> <span class="kw">map</span>(___, summarize_to_mean)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest</span>()</code></pre></li>
<li><p>When is a grouped operation preferable over nesting? Discuss.</p></li>
<li><p>Data frames are lists under the hood. Explain the output of the following code. What use cases can you imagine?</p>
<pre class="sourceCode r"><code class="sourceCode r">dict_data <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as.list</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">enframe</span>()</code></pre>
<PRE class="fansi fansi-output"><CODE>## <span style='color: #555555;'># A tibble: 5 x 2</span><span>
 ##   </span><span style='font-weight: bold;'>name</span><span>      </span><span style='font-weight: bold;'>value</span><span>     
 ##   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;list&gt;</span><span>    
 ## </span><span style='color: #555555;'>1</span><span> city_code </span><span style='color: #555555;'>&lt;chr [4]&gt;</span><span> 
 ## </span><span style='color: #555555;'>2</span><span> name      </span><span style='color: #555555;'>&lt;chr [4]&gt;</span><span> 
 ## </span><span style='color: #555555;'>3</span><span> lng       </span><span style='color: #555555;'>&lt;dbl [4]&gt;</span><span> 
 ## </span><span style='color: #555555;'>4</span><span> lat       </span><span style='color: #555555;'>&lt;dbl [4]&gt;</span><span> 
 ## </span><span style='color: #555555;'>5</span><span> data      </span><span style='color: #555555;'>&lt;list [4]&gt;</span><span>
 </span></CODE></PRE></li>
</ol>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="simple-iteration.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="scoping-and-flow-control.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
