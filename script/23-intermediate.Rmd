```{r 23-remove-all, include = FALSE}
rm(list = ls())
```


## Use case: Intermediate variables {#intermediate}

<details><summary>*Click here to show setup code.*</summary>
```{r include = FALSE}
### Use case: Intermediate variables

```
```{r 23-setup-33-intermediate-r}
library(tidyverse)
library(here)

weather_path <- function(filename) {
  # Returned value
  here("data/weather", filename)
}
```
</details>

We start with the function `weather_path()` from section ["Arguments"](#args).

Functions can help to avoid having to use intermediate variables:

```{r include = FALSE}
# Functions can help eliminate intermediate variables
```
```{r 23-functions-can-help-eliminate-intermediate-variables}
read_weather_file <- function(filename) {
  readxl::read_excel(weather_path(filename))
}

read_weather_data <- function() {
  # Create ensemble dataset from files on disk
  weather_data <- bind_rows(
    berlin = read_weather_file("berlin.xlsx"),
    toronto = read_weather_file("toronto.xlsx"),
    tel_aviv = read_weather_file("tel_aviv.xlsx"),
    zurich = read_weather_file("zurich.xlsx"),
    .id = "city_code"
  )

  # Return it
  weather_data
}

read_weather_data()
```


```{r include = FALSE}
### Exercise
```
```{r 23-exercise}

```


```{r include = FALSE}
# Simplify more?
```
```{r 23-simplify-more}

```

Here we create a function `weather_path_for()` that wraps a character variable in a path with the correct file ending.
This function is in turn called by `read_ecxel()` in our function `get_weather_for2()`.
As a result, `get_weather_for2()` works the same way as `get_weather_for()` (below), but it is easier to read and looks slightly more elegant:

```{r include = FALSE}
# Get rid of repeated .xlsx?
```
```{r 23-get-rid-of-repeated-xlsx}

get_weather_for <- function(city) {
  filename <- paste0(city, ".xlsx")

  readxl::read_excel(
    paste0(
      weather_path(filename)
    )
  )
}

weather_path_for <- function(city) {

  here("data/weather", paste0(city, ".xlsx"))
}

get_weather_for2 <- function(city) {
  readxl::read_excel(weather_path_for(city))
}

read_weather_data <- function() {
  # Create ensemble dataset from files on disk
  weather_data <- bind_rows(
    berlin = get_weather_for2("berlin"),
    toronto = get_weather_for2("toronto"),
    tel_aviv = get_weather_for2("tel_aviv"),
    zurich = get_weather_for2("zurich"),
    .id = "city_code"
  )

  # Return it
  weather_data
}

read_weather_data()
```
